{% extends "base.html" %}

{% block title %}Invoice Details - {{ invoice.invoice_number }}{% endblock %}

{% block content %}
<div class="container-fluid">
    <div class="row">
        <div class="col-12">
            <div class="page-title-box">
                <div class="page-title-right">
                    <ol class="breadcrumb m-0">
                        <li class="breadcrumb-item"><a href="{{ url_for('main.dashboard') }}">Dashboard</a></li>
                        <li class="breadcrumb-item"><a href="{{ url_for('sales.invoices') }}">Invoices</a></li>
                        <li class="breadcrumb-item active">Invoice Details</li>
                    </ol>
                </div>
                <h4 class="page-title">Invoice Details</h4>
            </div>
        </div>
    </div>

    <div class="row">
        <!-- Invoice Header -->
        <div class="col-12">
            <div class="card">
                <div class="card-body">
                    <div class="row align-items-center">
                        <div class="col-md-6">
                            <h3 class="mb-1">{{ invoice.invoice_number }}</h3>
                            <p class="text-muted mb-0">{{ invoice.subject }}</p>
                        </div>
                        <div class="col-md-6 text-md-end">
                            <div class="d-flex justify-content-md-end gap-2">
                                <a href="{{ url_for('sales.edit_invoice', invoice_id=invoice.id) }}" class="btn btn-primary">
                                    <i class="bi bi-pencil me-1"></i>Edit
                                </a>
                                <button class="btn btn-outline-success" onclick="markAsPaid()">
                                    <i class="bi bi-check-circle me-1"></i>Mark as Paid
                                </button>
                                <button class="btn btn-outline-info" onclick="duplicateInvoice()">
                                    <i class="bi bi-files me-1"></i>Duplicate
                                </button>
                                <div class="dropdown">
                                    <button class="btn btn-outline-secondary dropdown-toggle" type="button" data-bs-toggle="dropdown">
                                        <i class="bi bi-three-dots"></i>
                                    </button>
                                    <ul class="dropdown-menu">
                                        <li><a class="dropdown-item" href="#" onclick="downloadPDF()"><i class="bi bi-file-pdf me-2"></i>Download PDF</a></li>
                                        <li><a class="dropdown-item" href="#" onclick="sendEmail()"><i class="bi bi-envelope me-2"></i>Send Email</a></li>
                                        <li><a class="dropdown-item" href="#" onclick="printInvoice()"><i class="bi bi-printer me-2"></i>Print</a></li>
                                        <li><hr class="dropdown-divider"></li>
                                        <li><a class="dropdown-item text-danger" href="#" onclick="deleteInvoice()"><i class="bi bi-trash me-2"></i>Delete</a></li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="row">
        <!-- Invoice Information -->
        <div class="col-lg-8">
            <div class="card">
                <div class="card-header">
                    <h5 class="card-title mb-0">Invoice Information</h5>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label class="form-label fw-bold">Invoice Number</label>
                                <p class="form-control-plaintext">{{ invoice.invoice_number }}</p>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label class="form-label fw-bold">Status</label>
                                <p class="form-control-plaintext">
                                    <span class="badge bg-{{ 'success' if invoice.status.value == 'paid' else 'warning' if invoice.status.value == 'pending' else 'danger' if invoice.status.value == 'overdue' else 'info' if invoice.status.value == 'draft' else 'secondary' }}">
                                        {{ invoice.status.value.title() }}
                                    </span>
                                </p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label class="form-label fw-bold">Invoice Date</label>
                                <p class="form-control-plaintext">{{ invoice.invoice_date.strftime('%B %d, %Y') if invoice.invoice_date else 'N/A' }}</p>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label class="form-label fw-bold">Due Date</label>
                                <p class="form-control-plaintext">
                                    {% if invoice.due_date %}
                                        {{ invoice.due_date.strftime('%B %d, %Y') }}
                                        {% if invoice.is_overdue %}
                                            <span class="badge bg-danger ms-2">Overdue</span>
                                        {% endif %}
                                    {% else %}
                                        Not specified
                                    {% endif %}
                                </p>
                            </div>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label class="form-label fw-bold">Customer</label>
                                <p class="form-control-plaintext">
                                    <a href="{{ url_for('sales.customer_detail', customer_id=invoice.customer.id) }}">
                                        {{ invoice.customer.name }}
                                    </a>
                                </p>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label class="form-label fw-bold">Sales Person</label>
                                <p class="form-control-plaintext">{{ invoice.sales_person.get_full_name() if invoice.sales_person else 'Not assigned' }}</p>
                            </div>
                        </div>
                    </div>

                    <div class="mb-3">
                        <label class="form-label fw-bold">Subject</label>
                        <p class="form-control-plaintext">{{ invoice.subject or 'No subject' }}</p>
                    </div>

                    {% if invoice.notes %}
                    <div class="mb-3">
                        <label class="form-label fw-bold">Notes</label>
                        <p class="form-control-plaintext">{{ invoice.notes }}</p>
                    </div>
                    {% endif %}

                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label class="form-label fw-bold">Currency</label>
                                <p class="form-control-plaintext">{{ invoice.currency or 'INR' }}</p>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label class="form-label fw-bold">Tax Rate</label>
                                <p class="form-control-plaintext">{{ invoice.tax_rate or 0 }}%</p>
                            </div>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label class="form-label fw-bold">Payment Terms</label>
                                <p class="form-control-plaintext">{{ invoice.payment_terms.value.title() if invoice.payment_terms else 'Not specified' }}</p>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label class="form-label fw-bold">Payment Method</label>
                                <p class="form-control-plaintext">{{ invoice.payment_method.value.title() if invoice.payment_method else 'Not specified' }}</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Products & Services -->
            <div class="card">
                <div class="card-header">
                    <h5 class="card-title mb-0">Products & Services</h5>
                </div>
                <div class="card-body">
                    <div class="table-responsive">
                        <table class="table table-bordered">
                            <thead>
                                <tr>
                                    <th>Product/Service</th>
                                    <th class="text-center">Quantity</th>
                                    <th class="text-end">Unit Price</th>
                                    <th class="text-center">Discount</th>
                                    <th class="text-end">Total</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% if invoice.items %}
                                    {% for item in invoice.items %}
                                    <tr>
                                        <td>
                                            <div>
                                                <strong>{{ item.product.name if item.product else 'Product not found' }}</strong>
                                                {% if item.product and item.product.description %}
                                                    <br><small class="text-muted">{{ item.product.description[:100] }}{% if item.product.description|length > 100 %}...{% endif %}</small>
                                                {% endif %}
                                            </div>
                                        </td>
                                        <td class="text-center">{{ item.quantity }}</td>
                                        <td class="text-end">₹{{ "{:,.2f}".format(item.unit_price) }}</td>
                                        <td class="text-center">{{ item.discount or 0 }}%</td>
                                        <td class="text-end">₹{{ "{:,.2f}".format(item.total_amount) }}</td>
                                    </tr>
                                    {% endfor %}
                                {% else %}
                                    <tr>
                                        <td colspan="5" class="text-center text-muted">No products added</td>
                                    </tr>
                                {% endif %}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Billing Information -->
            {% if invoice.billing_address or invoice.shipping_address %}
            <div class="card">
                <div class="card-header">
                    <h5 class="card-title mb-0">Billing & Shipping Information</h5>
                </div>
                <div class="card-body">
                    <div class="row">
                        {% if invoice.billing_address %}
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label class="form-label fw-bold">Billing Address</label>
                                <p class="form-control-plaintext">{{ invoice.billing_address }}</p>
                            </div>
                        </div>
                        {% endif %}
                        
                        {% if invoice.shipping_address %}
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label class="form-label fw-bold">Shipping Address</label>
                                <p class="form-control-plaintext">{{ invoice.shipping_address }}</p>
                            </div>
                        </div>
                        {% endif %}
                    </div>
                </div>
            </div>
            {% endif %}

            <!-- Terms and Conditions -->
            {% if invoice.terms_conditions %}
            <div class="card">
                <div class="card-header">
                    <h5 class="card-title mb-0">Terms & Conditions</h5>
                </div>
                <div class="card-body">
                    <p class="mb-0">{{ invoice.terms_conditions }}</p>
                </div>
            </div>
            {% endif %}
        </div>

        <!-- Sidebar -->
        <div class="col-lg-4">
            <!-- Summary -->
            <div class="card">
                <div class="card-header">
                    <h5 class="card-title mb-0">Financial Summary</h5>
                </div>
                <div class="card-body">
                    <div class="d-flex justify-content-between mb-2">
                        <span>Subtotal:</span>
                        <span>₹{{ "{:,.2f}".format(invoice.subtotal) }}</span>
                    </div>
                    <div class="d-flex justify-content-between mb-2">
                        <span>Discount:</span>
                        <span>₹{{ "{:,.2f}".format(invoice.total_discount) }}</span>
                    </div>
                    <div class="d-flex justify-content-between mb-2">
                        <span>Tax ({{ invoice.tax_rate or 0 }}%):</span>
                        <span>₹{{ "{:,.2f}".format(invoice.tax_amount) }}</span>
                    </div>
                    <hr>
                    <div class="d-flex justify-content-between fw-bold fs-5">
                        <span>Total:</span>
                        <span class="text-primary">₹{{ "{:,.2f}".format(invoice.grand_total) }}</span>
                    </div>
                </div>
            </div>

            <!-- Payment Information -->
            <div class="card">
                <div class="card-header">
                    <h5 class="card-title mb-0">Payment Information</h5>
                </div>
                <div class="card-body">
                    <div class="mb-3">
                        <label class="form-label fw-bold">Payment Status</label>
                        <p class="form-control-plaintext">
                            <span class="badge bg-{{ 'success' if invoice.payment_status.value == 'paid' else 'warning' if invoice.payment_status.value == 'partial' else 'danger' }}">
                                {{ invoice.payment_status.value.title() }}
                            </span>
                        </p>
                    </div>
                    
                    {% if invoice.payment_amount %}
                    <div class="mb-3">
                        <label class="form-label fw-bold">Amount Paid</label>
                        <p class="form-control-plaintext">₹{{ "{:,.2f}".format(invoice.payment_amount) }}</p>
                    </div>
                    {% endif %}
                    
                    {% if invoice.payment_date %}
                    <div class="mb-3">
                        <label class="form-label fw-bold">Payment Date</label>
                        <p class="form-control-plaintext">{{ invoice.payment_date.strftime('%B %d, %Y') }}</p>
                    </div>
                    {% endif %}
                    
                    {% if invoice.payment_status.value == 'partial' %}
                    <div class="mb-3">
                        <label class="form-label fw-bold">Balance Due</label>
                        <p class="form-control-plaintext text-danger">₹{{ "{:,.2f}".format(invoice.balance_due) }}</p>
                    </div>
                    {% endif %}
                </div>
            </div>

            <!-- Customer Information -->
            <div class="card">
                <div class="card-header">
                    <h5 class="card-title mb-0">Customer Information</h5>
                </div>
                <div class="card-body">
                    <div class="mb-3">
                        <label class="form-label fw-bold">Company</label>
                        <p class="form-control-plaintext">{{ invoice.customer.name }}</p>
                    </div>
                    
                    {% if invoice.customer.email %}
                    <div class="mb-3">
                        <label class="form-label fw-bold">Email</label>
                        <p class="form-control-plaintext">
                            <a href="mailto:{{ invoice.customer.email }}">{{ invoice.customer.email }}</a>
                        </p>
                    </div>
                    {% endif %}
                    
                    {% if invoice.customer.phone %}
                    <div class="mb-3">
                        <label class="form-label fw-bold">Phone</label>
                        <p class="form-control-plaintext">
                            <a href="tel:{{ invoice.customer.phone }}">{{ invoice.customer.phone }}</a>
                        </p>
                    </div>
                    {% endif %}
                    
                    {% if invoice.customer.address %}
                    <div class="mb-3">
                        <label class="form-label fw-bold">Address</label>
                        <p class="form-control-plaintext">{{ invoice.customer.address }}</p>
                    </div>
                    {% endif %}
                </div>
            </div>

            <!-- Invoice Timeline -->
            <div class="card">
                <div class="card-header">
                    <h5 class="card-title mb-0">Timeline</h5>
                </div>
                <div class="card-body">
                    <div class="timeline">
                        <div class="timeline-item">
                            <div class="timeline-marker bg-primary"></div>
                            <div class="timeline-content">
                                <h6 class="mb-1">Created</h6>
                                <p class="text-muted mb-0">{{ invoice.created_at.strftime('%B %d, %Y at %I:%M %p') if invoice.created_at else 'N/A' }}</p>
                            </div>
                        </div>
                        
                        {% if invoice.sent_at %}
                        <div class="timeline-item">
                            <div class="timeline-marker bg-success"></div>
                            <div class="timeline-content">
                                <h6 class="mb-1">Sent to Customer</h6>
                                <p class="text-muted mb-0">{{ invoice.sent_at.strftime('%B %d, %Y at %I:%M %p') }}</p>
                            </div>
                        </div>
                        {% endif %}
                        
                        {% if invoice.viewed_at %}
                        <div class="timeline-item">
                            <div class="timeline-marker bg-info"></div>
                            <div class="timeline-content">
                                <h6 class="mb-1">Viewed by Customer</h6>
                                <p class="text-muted mb-0">{{ invoice.viewed_at.strftime('%B %d, %Y at %I:%M %p') }}</p>
                            </div>
                        </div>
                        {% endif %}
                        
                        {% if invoice.payment_date %}
                        <div class="timeline-item">
                            <div class="timeline-marker bg-success"></div>
                            <div class="timeline-content">
                                <h6 class="mb-1">Payment Received</h6>
                                <p class="text-muted mb-0">{{ invoice.payment_date.strftime('%B %d, %Y') }}</p>
                            </div>
                        </div>
                        {% endif %}
                        
                        {% if invoice.due_date %}
                        <div class="timeline-item">
                            <div class="timeline-marker bg-{{ 'danger' if invoice.is_overdue else 'warning' }}"></div>
                            <div class="timeline-content">
                                <h6 class="mb-1">Due Date</h6>
                                <p class="text-muted mb-0">{{ invoice.due_date.strftime('%B %d, %Y') }}</p>
                            </div>
                        </div>
                        {% endif %}
                    </div>
                </div>
            </div>

            <!-- Quick Actions -->
            <div class="card">
                <div class="card-header">
                    <h5 class="card-title mb-0">Quick Actions</h5>
                </div>
                <div class="card-body">
                    <div class="d-grid gap-2">
                        <button class="btn btn-outline-primary" onclick="sendReminder()">
                            <i class="bi bi-bell me-1"></i>Send Reminder
                        </button>
                        <button class="btn btn-outline-success" onclick="recordPayment()">
                            <i class="bi bi-cash me-1"></i>Record Payment
                        </button>
                        <button class="btn btn-outline-warning" onclick="extendDueDate()">
                            <i class="bi bi-calendar-plus me-1"></i>Extend Due Date
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Related Records -->
    <div class="row">
        <div class="col-12">
            <div class="card">
                <div class="card-header">
                    <h5 class="card-title mb-0">Related Records</h5>
                </div>
                <div class="card-body">
                    <ul class="nav nav-tabs" id="relatedTabs" role="tablist">
                        <li class="nav-item" role="presentation">
                            <button class="nav-link active" id="payments-tab" data-bs-toggle="tab" data-bs-target="#payments" type="button" role="tab">
                                <i class="bi bi-cash me-1"></i>Payment History
                            </button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="emails-tab" data-bs-toggle="tab" data-bs-target="#emails" type="button" role="tab">
                                <i class="bi bi-envelope me-1"></i>Email History
                            </button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="activities-tab" data-bs-toggle="tab" data-bs-target="#activities" type="button" role="tab">
                                <i class="bi bi-activity me-1"></i>Activity Log
                            </button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="quotations-tab" data-bs-toggle="tab" data-bs-target="#quotations" type="button" role="tab">
                                <i class="bi bi-file-text me-1"></i>Related Quotations
                            </button>
                        </li>
                    </ul>
                    
                    <div class="tab-content mt-3" id="relatedTabsContent">
                        <!-- Payment History -->
                        <div class="tab-pane fade show active" id="payments" role="tabpanel">
                            {% if payment_history %}
                                <div class="table-responsive">
                                    <table class="table table-hover">
                                        <thead>
                                            <tr>
                                                <th>Date</th>
                                                <th>Amount</th>
                                                <th>Method</th>
                                                <th>Reference</th>
                                                <th>Status</th>
                                                <th>Actions</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            {% for payment in payment_history %}
                                            <tr>
                                                <td>{{ payment.payment_date.strftime('%Y-%m-%d') }}</td>
                                                <td>₹{{ "{:,.2f}".format(payment.amount) }}</td>
                                                <td>{{ payment.payment_method.value.title() if payment.payment_method else 'N/A' }}</td>
                                                <td>{{ payment.reference or 'N/A' }}</td>
                                                <td>
                                                    <span class="badge bg-{{ 'success' if payment.status == 'completed' else 'warning' if payment.status == 'pending' else 'danger' }}">
                                                        {{ payment.status.title() }}
                                                    </span>
                                                </td>
                                                <td>
                                                    <button class="btn btn-sm btn-outline-primary" onclick="viewPaymentDetails({{ payment.id }})">
                                                        <i class="bi bi-eye"></i>
                                                    </button>
                                                </td>
                                            </tr>
                                            {% endfor %}
                                        </tbody>
                                    </table>
                                </div>
                            {% else %}
                                <div class="text-center text-muted py-4">
                                    <i class="bi bi-cash fs-1 mb-3"></i>
                                    <p>No payment history found</p>
                                    <button class="btn btn-primary" onclick="recordPayment()">
                                        <i class="bi bi-cash me-1"></i>Record Payment
                                    </button>
                                </div>
                            {% endif %}
                        </div>

                        <!-- Email History -->
                        <div class="tab-pane fade" id="emails" role="tabpanel">
                            {% if email_history %}
                                <div class="table-responsive">
                                    <table class="table table-hover">
                                        <thead>
                                            <tr>
                                                <th>Date</th>
                                                <th>Subject</th>
                                                <th>Recipient</th>
                                                <th>Status</th>
                                                <th>Actions</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            {% for email in email_history %}
                                            <tr>
                                                <td>{{ email.sent_at.strftime('%Y-%m-%d %H:%M') }}</td>
                                                <td>{{ email.subject }}</td>
                                                <td>{{ email.recipient }}</td>
                                                <td>
                                                    <span class="badge bg-{{ 'success' if email.status == 'sent' else 'warning' if email.status == 'pending' else 'danger' }}">
                                                        {{ email.status.title() }}
                                                    </span>
                                                </td>
                                                <td>
                                                    <button class="btn btn-sm btn-outline-primary" onclick="resendEmail({{ email.id }})">
                                                        <i class="bi bi-arrow-repeat"></i>
                                                    </button>
                                                </td>
                                            </tr>
                                            {% endfor %}
                                        </tbody>
                                    </table>
                                </div>
                            {% else %}
                                <div class="text-center text-muted py-4">
                                    <i class="bi bi-envelope fs-1 mb-3"></i>
                                    <p>No email history found</p>
                                </div>
                            {% endif %}
                        </div>

                        <!-- Activity Log -->
                        <div class="tab-pane fade" id="activities" role="tabpanel">
                            {% if activity_log %}
                                <div class="table-responsive">
                                    <table class="table table-hover">
                                        <thead>
                                            <tr>
                                                <th>Date</th>
                                                <th>Activity</th>
                                                <th>User</th>
                                                <th>Details</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            {% for activity in activity_log %}
                                            <tr>
                                                <td>{{ activity.timestamp.strftime('%Y-%m-%d %H:%M') }}</td>
                                                <td>
                                                    <span class="badge bg-{{ 'primary' if activity.type == 'created' else 'success' if activity.type == 'updated' else 'info' if activity.type == 'sent' else 'warning' }}">
                                                        {{ activity.type.title() }}
                                                    </span>
                                                </td>
                                                <td>{{ activity.user.get_full_name() if activity.user else 'System' }}</td>
                                                <td>{{ activity.details }}</td>
                                            </tr>
                                            {% endfor %}
                                        </tbody>
                                    </table>
                                </div>
                            {% else %}
                                <div class="text-center text-muted py-4">
                                    <i class="bi bi-activity fs-1 mb-3"></i>
                                    <p>No activity log found</p>
                                </div>
                            {% endif %}
                        </div>

                        <!-- Related Quotations -->
                        <div class="tab-pane fade" id="quotations" role="tabpanel">
                            {% if related_quotations %}
                                <div class="table-responsive">
                                    <table class="table table-hover">
                                        <thead>
                                            <tr>
                                                <th>Quotation #</th>
                                                <th>Date</th>
                                                <th>Amount</th>
                                                <th>Status</th>
                                                <th>Actions</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            {% for quotation in related_quotations %}
                                            <tr>
                                                <td>
                                                    <a href="{{ url_for('sales.quotation_detail', quotation_id=quotation.id) }}">
                                                        {{ quotation.quotation_number }}
                                                    </a>
                                                </td>
                                                <td>{{ quotation.quotation_date.strftime('%Y-%m-%d') }}</td>
                                                <td>₹{{ "{:,.2f}".format(quotation.grand_total) }}</td>
                                                <td>
                                                    <span class="badge bg-{{ 'success' if quotation.status.value == 'accepted' else 'warning' if quotation.status.value == 'sent' else 'info' if quotation.status.value == 'viewed' else 'secondary' }}">
                                                        {{ quotation.status.value.title() }}
                                                    </span>
                                                </td>
                                                <td>
                                                    <a href="{{ url_for('sales.quotation_detail', quotation_id=quotation.id) }}" class="btn btn-sm btn-outline-primary">
                                                        <i class="bi bi-eye"></i>
                                                    </a>
                                                </td>
                                            </tr>
                                            {% endfor %}
                                        </tbody>
                                    </table>
                                </div>
                            {% else %}
                                <div class="text-center text-muted py-4">
                                    <i class="bi bi-file-text fs-1 mb-3"></i>
                                    <p>No related quotations found</p>
                                </div>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
.timeline {
    position: relative;
    padding-left: 30px;
}

.timeline-item {
    position: relative;
    margin-bottom: 20px;
}

.timeline-marker {
    position: absolute;
    left: -35px;
    width: 12px;
    height: 12px;
    border-radius: 50%;
    border: 2px solid #fff;
    box-shadow: 0 0 0 3px #dee2e6;
}

.timeline-item:not(:last-child)::after {
    content: '';
    position: absolute;
    left: -29px;
    top: 12px;
    width: 2px;
    height: calc(100% + 8px);
    background-color: #dee2e6;
}

.timeline-content h6 {
    margin-bottom: 5px;
    font-size: 0.875rem;
}

.timeline-content p {
    font-size: 0.75rem;
}
</style>

<script>
function markAsPaid() {
    if (confirm('Mark this invoice as paid?')) {
        // Implement mark as paid functionality
        alert('Mark as paid functionality will be implemented');
    }
}

function duplicateInvoice() {
    if (confirm('Create a copy of this invoice?')) {
        window.location.href = "{{ url_for('sales.duplicate_invoice', invoice_id=invoice.id) }}";
    }
}

function downloadPDF() {
    window.open("{{ url_for('sales.download_invoice_pdf', invoice_id=invoice.id) }}", '_blank');
}

function sendEmail() {
    if (confirm('Send this invoice to the customer?')) {
        // Implement send email functionality
        alert('Send email functionality will be implemented');
    }
}

function printInvoice() {
    window.print();
}

function deleteInvoice() {
    if (confirm('Are you sure you want to delete this invoice? This action cannot be undone.')) {
        fetch("{{ url_for('sales.delete_invoice', invoice_id=invoice.id) }}", {
            method: 'DELETE',
            headers: {
                'Content-Type': 'application/json',
            }
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                alert('Invoice deleted successfully!');
                window.location.href = "{{ url_for('sales.invoices') }}";
            } else {
                alert('Error: ' + data.message);
            }
        });
    }
}

function sendReminder() {
    if (confirm('Send a payment reminder to the customer?')) {
        // Implement send reminder functionality
        alert('Send reminder functionality will be implemented');
    }
}

function recordPayment() {
    if (confirm('Record a payment for this invoice?')) {
        // Implement record payment functionality
        alert('Record payment functionality will be implemented');
    }
}

function extendDueDate() {
    if (confirm('Extend the due date of this invoice?')) {
        // Implement extend due date functionality
        alert('Extend due date functionality will be implemented');
    }
}

function viewPaymentDetails(paymentId) {
    // Implement view payment details functionality
    alert('View payment details functionality will be implemented');
}

function resendEmail(emailId) {
    if (confirm('Resend this email?')) {
        // Implement resend email functionality
        alert('Resend email functionality will be implemented');
    }
}
</script>
{% endblock %}
